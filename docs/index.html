<!DOCTYPE html>
<html>
  <head>
    <title>Oficina de R - Intermediário</title>
    <meta charset="utf-8">
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/rladies.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/robot-fonts.css" rel="stylesheet" />
    <script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
    <script src="libs/jquery-1.12.4/jquery.min.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.5/datatables.js"></script>
    <link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
    <script src="libs/pymjs-1.3.2/pym.v1.js"></script>
    <script src="libs/widgetframe-binding-0.3.1/widgetframe.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Oficina de R - Intermediário
## R-Ladies São Paulo <br> <br> <a href="http://bit.ly/rladiesSP6">bit.ly/rladiesSP6</a>
### 23/02/2019

---



&lt;style type="text/css"&gt;
#pre {
 # max-width: 100%;
  #overflow-x: scroll;
   #height: 10pc;
  #overflow-y: scroll;
#}
&lt;/style&gt;
&lt;style&gt;
.remark-slide-number {
  position: inherit;
}

.remark-slide-number .progress-bar-container {
  position: absolute;
  bottom: 0;
  height: 4px;
  display: block;
  left: 0;
  right: 0;
}

.remark-slide-number .progress-bar {
  height: 100%;
  background-color: red;
}
&lt;/style&gt;
class:  center, middle

##Organização e realização:
&lt;img src="img/rladies.jpeg" width="15%" style="display: block; margin: auto;" /&gt;
[R-Ladies São Paulo](https://www.meetup.com/R-Ladies-Sao-Paulo)

##Apoio:

&lt;img src="img/loggi.png" width="50%" style="display: block; margin: auto;" /&gt;

[Loggi](https://www.loggi.com/)

---
class:  center, middle
# O que é o R-Ladies?

R-Ladies é uma organização mundial que promove a diversidade de gênero na comunidade da linguagem R.
R-Ladies São Paulo integra, orgulhosamente, a organização R-Ladies Global, em São Paulo.

# Como?

Através de meetups e mentorias em um ambiente seguro e amigável.

Nosso principal objetivo é promover a linguagem computacional estatística R compartilhando conhecimento, assim, quem tiver interesse na linguagem será bem-vinda, independente do nível de conhecimento. 


Fonte: [About us - R-Ladies](https://rladies.org/about-us/), [Meetup R-Ladies São Paulo](https://www.meetup.com/R-Ladies-Sao-Paulo/)

---
class:   center, middle
# Para quem?
Nosso principal público-alvo são as pessoas que se identificam com o gênero feminino, portanto, mulheres cis, mulheres trans, bem como pessoas não-binárias e queer.

# Missão

Como uma iniciativa de diversidade, a missão das R-Ladies é alcançar uma representação proporcional de pessoas de gêneros atualmente sub-representados na comunidade R, incentivando, inspirando e caacitando-as.



Fonte: [About us - R-Ladies](https://rladies.org/about-us/), [Meetup R-Ladies São Paulo](https://www.meetup.com/R-Ladies-Sao-Paulo/)

---
class:   center, middle
## Como o R-Ladies começou?
&lt;img src="img/gabriela.jpeg" width="20%" style="display: block; margin: auto;" /&gt;
**[Gabriela de Queiroz](https://github.com/gdequeiroz)** fundou o R-Ladies no dia **1 de outubro de 2012**. Ela queria retribuir à comunidade depois de ir a vários encontros e aprender muito de graça. O primeiro encontro R-Ladies foi realizado em ** San Francisco, Califórnia (Estados Unidos) **. Nos anos seguintes, mais capítulos do R-Ladies começaram em todo o mundo.

Fonte: [About us - R-Ladies](https://rladies.org/about-us/history/)


---
class:center, middle

&lt;img src="img/shiny2.png" width="100%" style="display: block; margin: auto;" /&gt;


Fonte: [R-Ladies Shiny App](https://gqueiroz.shinyapps.io/rshinylady/)  (26/01/2019)
---
class:   center, middle
# Código de conduta


O R-Ladies dedica-se a proporcionar uma experiência livre de assédio para todos. Não toleramos nenhuma forma de assédio aos participantes.


[Código de conduta - R-Ladies](https://github.com/rladies/starter-kit/wiki/Code-of-Conduct#portuguese)


---
class:  center, middle
# Como saber mais?

[Meetup](https://www.meetup.com/pt-BR/R-Ladies-Sao-Paulo)

Twitter: [@RLadiesGlobal](https://twitter.com/rladiesglobal)

Website: [https://rladies.org/](https://rladies.org/)

R-Ladies LATAM Blog (Latin America) - Em breve!


[R-Ladies - How do get involved](https://rladies.org/about-us/help/)

---
class:   center, middle

# R-Ladies São Paulo


&lt;img src="img/1meetupsp.jpeg" width="70%" style="display: block; margin: auto;" /&gt;
**Primero Meetup R-Ladies em São Paulo - Agosto/2018**


---
class:   middle
# Cronograma de hoje

## Manhã:
- Revisão - O que é o tidyverse e dplyr
- Introdução ao purrr
- Introdução ao ggplot2 

## Tarde:

- Introdução ao ggplot2 
- Introdução ao RMarkdown
---
class:   middle, center
# Tidyverse
---

### Relembrando: O Tidyverse

É uma coleção de pacotes R projetados para a ciência de dados. Todos os pacotes compartilham uma mesma filosofia de desenvolvimento, sintaxe e estruturas de dados.


```r
install.packages("tidyverse") #para instalar o tidyverse
library(tidyverse) #para utilizar o tidyverse
```

&lt;img src="img/Tidyverse_packages.png" width="60%" style="display: block; margin: auto;" /&gt;

---

### Pacotes do Tidyverse

- **ggplot2**: cria gráficos &lt;br&gt;&lt;/br&gt;
- **dplyr**: manipulação de dados &lt;br&gt;&lt;/br&gt;
- **tidyr**: arruma os dados &lt;br&gt;&lt;/br&gt;
- **readr**: leitura dos dados &lt;br&gt;&lt;/br&gt;
- **purrr**: ferramentas para programação funcional, trabalha com funções e vetores &lt;br&gt;&lt;/br&gt;
- **tibble**: dataframes moderno, mais simples de manipular &lt;br&gt;&lt;/br&gt;
- **magrittr**: facilita a escrita e leitura do código &lt;br&gt;&lt;/br&gt;
- **stringr**: trabalha com strings &lt;br&gt;&lt;/br&gt;
- **forcats**: trabalha com fatores &lt;br&gt;&lt;/br&gt;
- **lubridate**: trabalha com datas

---

### dplyr

A ideia do pacote **dplyr** é tornar a manipulação de dados explícita utilizando verbos que indicam a ação a ser realizada. 

O encadeamento dos verbos com o banco de dados é realizado com o operador **pipe**: **%&gt;%**

O dplyr foi desenhado para trabalhar com o operator pipe **%&gt;%** do pacote magritrr.

---

### Pipe (%&gt;%)

**Atalho**: CTRL + SHIFT + M

Pense no Pipe %&gt;% como um operador que aplica as operações à direita nos valores que estão à esquerda.

**Exemplo:**

gosta_de_melancia &lt;- df_turma_da_monica %&gt;% 
                      filter(personagem == "Magali")
                      
No código acima, temos um objeto chamado **gosta_de_melancia**, um dataset chamado **df_turma_da_monica** e uma operação de **filtro**.

À direita do Pipe temos: filter(personagem == "Magali")

À esquerda do Pipe temos: df_turma_da_monica

Portanto, será aplicado o filtro personagem == "Magali" no dataset df_turma_da_monica. E o resultado dessa operação será atribuída ao objeto gosta_de_melancia.

---

### Importação de arquivos


```r
library(tidyverse)

# Uma outra opção é carregar somente o(s) pacote(s) que irá utilizar.
#library(dplyr)

# Importa o arquivo csv para o objeto df_titanic
df_titanic &lt;- read_csv("data/titanic.csv")
```

---

### View e glimpse

- Para visualizar um objeto: **View**(nome-do-objeto)

- **glimpse()**: mostra informações como o número de observações (linhas) e variáveis (colunas), o nome das colunas, o tipo delas e os primeiros dados de cada coluna.


```r
df_titanic %&gt;% glimpse()
```

```
## Observations: 891
## Variables: 12
## $ id_passageiro  &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15…
## $ sobreviveu     &lt;chr&gt; "nao", "sim", "sim", "sim", "nao", "nao", "nao", …
## $ classe         &lt;dbl&gt; 3, 1, 3, 1, 3, 3, 1, 3, 3, 2, 3, 1, 3, 3, 3, 2, 3…
## $ nome           &lt;chr&gt; "Braund, Mr. Owen Harris", "Cumings, Mrs. John Br…
## $ sexo           &lt;chr&gt; "masculino", "feminino", "feminino", "feminino", …
## $ idade          &lt;dbl&gt; 22, 38, 26, 35, 35, NA, 54, 2, 27, 14, 4, 58, 20,…
## $ irmaos_conjuge &lt;dbl&gt; 1, 1, 0, 1, 0, 0, 0, 3, 0, 1, 1, 0, 0, 1, 0, 0, 4…
## $ pais_criancas  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 1, 0, 0, 5, 0, 0, 1…
## $ passagem       &lt;chr&gt; "A/5 21171", "PC 17599", "STON/O2. 3101282", "113…
## $ tarifa         &lt;dbl&gt; 7.2500, 71.2833, 7.9250, 53.1000, 8.0500, 8.4583,…
## $ cabine         &lt;chr&gt; NA, "C85", NA, "C123", NA, NA, "E46", NA, NA, NA,…
## $ embarque       &lt;chr&gt; "Southampton", "Cherbourg", "Southampton", "South…
```

---


### Relembrando: Os 6 verbos do dplyr 

- **filter**(): seleciona linhas

- **arrange**(): ordena de acordo com uma ou mais colunas 

- **select**(): seleciona colunas 

- **mutate**(): cria/modifica colunas 

- **summarise**(): sumariza/agrega colunas

- **group_by**(): agrupa colunas

---

# filter

Selecionar linhas da base de dados.


```r
# Seleciona os sobreviventes.
df_titanic %&gt;% filter(sobreviveu == "sim")
```

```
## # A tibble: 342 x 12
##    id_passageiro sobreviveu classe nome  sexo  idade irmaos_conjuge
##            &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;          &lt;dbl&gt;
##  1             2 sim             1 Cumi… femi…    38              1
##  2             3 sim             3 Heik… femi…    26              0
##  3             4 sim             1 Futr… femi…    35              1
##  4             9 sim             3 John… femi…    27              0
##  5            10 sim             2 Nass… femi…    14              1
##  6            11 sim             3 Sand… femi…     4              1
##  7            12 sim             1 Bonn… femi…    58              0
##  8            16 sim             2 Hewl… femi…    55              0
##  9            18 sim             2 Will… masc…    NA              0
## 10            20 sim             3 Mass… femi…    NA              0
## # … with 332 more rows, and 5 more variables: pais_criancas &lt;dbl&gt;,
## #   passagem &lt;chr&gt;, tarifa &lt;dbl&gt;, cabine &lt;chr&gt;, embarque &lt;chr&gt;
```

---

# arrange

Ordenar as linhas da base de dados conforme uma ou mais variáveis.


```r
# Ordena por ordem crescente da coluna nome.
passageiros_ordenados &lt;- df_titanic %&gt;% arrange(nome)
passageiros_ordenados
```

```
## # A tibble: 891 x 12
##    id_passageiro sobreviveu classe nome  sexo  idade irmaos_conjuge
##            &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;          &lt;dbl&gt;
##  1           846 nao             3 Abbi… masc…    42              0
##  2           747 nao             3 Abbo… masc…    16              1
##  3           280 sim             3 Abbo… femi…    35              1
##  4           309 nao             2 Abel… masc…    30              1
##  5           875 sim             2 Abel… femi…    28              1
##  6           366 nao             3 Adah… masc…    30              0
##  7           402 nao             3 Adam… masc…    26              0
##  8            41 nao             3 Ahli… femi…    40              1
##  9           856 sim             3 Aks,… femi…    18              0
## 10           208 sim             3 Albi… masc…    26              0
## # … with 881 more rows, and 5 more variables: pais_criancas &lt;dbl&gt;,
## #   passagem &lt;chr&gt;, tarifa &lt;dbl&gt;, cabine &lt;chr&gt;, embarque &lt;chr&gt;
```

---

# arrange 

É possível ordenar na ordem descrescente e também por mais de uma variável.


```r
# Ordena por ordem decrescente de idade e por ordem crescente de nome.
passageiros_ordenados &lt;- df_titanic %&gt;% arrange(desc(idade), nome)
passageiros_ordenados
```

```
## # A tibble: 891 x 12
##    id_passageiro sobreviveu classe nome  sexo  idade irmaos_conjuge
##            &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;          &lt;dbl&gt;
##  1           631 sim             1 Bark… masc…  80                0
##  2           852 nao             3 Sven… masc…  74                0
##  3           494 nao             1 Arta… masc…  71                0
##  4            97 nao             1 Gold… masc…  71                0
##  5           117 nao             3 Conn… masc…  70.5              0
##  6           746 nao             1 Cros… masc…  70                1
##  7           673 nao             2 Mitc… masc…  70                0
##  8            34 nao             2 Whea… masc…  66                0
##  9           281 nao             3 Duan… masc…  65                0
## 10           457 nao             1 Mill… masc…  65                0
## # … with 881 more rows, and 5 more variables: pais_criancas &lt;dbl&gt;,
## #   passagem &lt;chr&gt;, tarifa &lt;dbl&gt;, cabine &lt;chr&gt;, embarque &lt;chr&gt;
```

---

# filter &amp; arrange


```r
# Filtra os sobreviventes homens e ordena por classe.
df_titanic  %&gt;% 
  filter(sexo == "masculino" &amp; sobreviveu == "sim") %&gt;% 
  arrange(classe)
```

```
## # A tibble: 109 x 12
##    id_passageiro sobreviveu classe nome  sexo  idade irmaos_conjuge
##            &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;          &lt;dbl&gt;
##  1            24 sim             1 Slop… masc… 28                 0
##  2            56 sim             1 Wool… masc… NA                 0
##  3            98 sim             1 Gree… masc… 23                 0
##  4           188 sim             1 "Rom… masc… 45                 0
##  5           210 sim             1 Blan… masc… 40                 0
##  6           225 sim             1 Hoyt… masc… 38                 1
##  7           249 sim             1 Beck… masc… 37                 1
##  8           299 sim             1 Saal… masc… NA                 0
##  9           306 sim             1 Alli… masc…  0.92              1
## 10           371 sim             1 Hard… masc… 25                 1
## # … with 99 more rows, and 5 more variables: pais_criancas &lt;dbl&gt;,
## #   passagem &lt;chr&gt;, tarifa &lt;dbl&gt;, cabine &lt;chr&gt;, embarque &lt;chr&gt;
```

---

# select

Selecionar colunas (variáveis) da base de dados.


```r
# Seleciona as colunas indicadas.
df_titanic %&gt;% select(nome, idade, classe, embarque)
```

```
## # A tibble: 891 x 4
##    nome                                             idade classe embarque  
##    &lt;chr&gt;                                            &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     
##  1 Braund, Mr. Owen Harris                             22      3 Southampt…
##  2 Cumings, Mrs. John Bradley (Florence Briggs Tha…    38      1 Cherbourg 
##  3 Heikkinen, Miss. Laina                              26      3 Southampt…
##  4 Futrelle, Mrs. Jacques Heath (Lily May Peel)        35      1 Southampt…
##  5 Allen, Mr. William Henry                            35      3 Southampt…
##  6 Moran, Mr. James                                    NA      3 Queenstow 
##  7 McCarthy, Mr. Timothy J                             54      1 Southampt…
##  8 Palsson, Master. Gosta Leonard                       2      3 Southampt…
##  9 Johnson, Mrs. Oscar W (Elisabeth Vilhelmina Ber…    27      3 Southampt…
## 10 Nasser, Mrs. Nicholas (Adele Achem)                 14      2 Cherbourg 
## # … with 881 more rows
```

---

# select

O select tem várias funções úteis, como por exemplo:

- **starts_with**("cla"): seleciona colunas que começam com "cla" &lt;br&gt;&lt;/br&gt;
- **ends_with**("ifa"): seleciona colunas que terminam com "ifa" &lt;br&gt;&lt;/br&gt;
- **contains**("ssa"): seleciona colunas que contêm "ssa" &lt;br&gt;&lt;/br&gt;

---

# select


```r
# Seleciona as colunas que começam com "id".
df_titanic %&gt;%  select(starts_with("id"))
```

```
## # A tibble: 891 x 2
##    id_passageiro idade
##            &lt;dbl&gt; &lt;dbl&gt;
##  1             1    22
##  2             2    38
##  3             3    26
##  4             4    35
##  5             5    35
##  6             6    NA
##  7             7    54
##  8             8     2
##  9             9    27
## 10            10    14
## # … with 881 more rows
```

---

# select

Ao inserir o caracter **-** na frente da coluna, você estará excluindo as colunas da seleção.


```r
df_titanic %&gt;%  select(-id_passageiro, -nome)
```

```
## # A tibble: 891 x 10
##    sobreviveu classe sexo  idade irmaos_conjuge pais_criancas passagem
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;   
##  1 nao             3 masc…    22              1             0 A/5 211…
##  2 sim             1 femi…    38              1             0 PC 17599
##  3 sim             3 femi…    26              0             0 STON/O2…
##  4 sim             1 femi…    35              1             0 113803  
##  5 nao             3 masc…    35              0             0 373450  
##  6 nao             3 masc…    NA              0             0 330877  
##  7 nao             1 masc…    54              0             0 17463   
##  8 nao             3 masc…     2              3             1 349909  
##  9 sim             3 femi…    27              0             2 347742  
## 10 sim             2 femi…    14              1             0 237736  
## # … with 881 more rows, and 3 more variables: tarifa &lt;dbl&gt;, cabine &lt;chr&gt;,
## #   embarque &lt;chr&gt;
```

---

# mutate

Criar ou modificar colunas de uma base de dados.

Supondo que o valor da tarifa no dataset está em libras, e que 1£ = R$ 4.93, vamos descobrir qual é o valor das tarifas em reais.


```r
# Calcula a coluna tarifa para o valor da tarifa em reais e 
# atribui ao objeto tarifa_conversao, 
# o df_titanic e a coluna tarifa já calculada. 
# Importante: neste caso a coluna tarifa do df_titanic não é alterada.
tarifa_conversao &lt;- df_titanic %&gt;% mutate(tarifa = tarifa * 4.93)
```


```r
# Cria uma nova variável chamada tarifa_real e
# atribui ao objeto tarifa_conversao o df_titanic e 
# mais a nova coluna tarifa_real.
# Importante: neste caso não é criado uma nova coluna no df_titanic.
tarifa_conversao &lt;- df_titanic %&gt;% mutate(tarifa_real = tarifa * 4.93)
```

---

# summarize

Sumariza colunas da base de dados, ou seja, resume os valores das colunas em um só valor,
podendo ser a média, mediana, min, max, etc.


```r
# Calcula a média da variável idade
# na.rm = TRUE remove os NAs
df_titanic %&gt;% summarize(mean(idade, na.rm=TRUE))
```

```
## # A tibble: 1 x 1
##   `mean(idade, na.rm = TRUE)`
##                         &lt;dbl&gt;
## 1                        29.7
```

---

# group_by + summarize

Agrupa as colunas de uma base de dados. 

O group_by é bastante utilizado com o summarize.


```r
# Agrupa pela variável sobreviveu e 
# calcula o número de passageiros por grupo (sim/nao).
# A função n() mostra o número de linhas em cada grupo.
df_titanic %&gt;% 
  group_by(sobreviveu) %&gt;% 
  summarize(num_passageiros = n())
```

```
## # A tibble: 2 x 2
##   sobreviveu num_passageiros
##   &lt;chr&gt;                &lt;int&gt;
## 1 nao                    549
## 2 sim                    342
```




---
# dplyr - os n verbos

- Manipulação de observações 

    - **filter()**, distinct(), sample_frac(), sample_frac(), slice()
    - **arrange()**,desc(), add_row()


- Manipulação de variáveis

    - **select()**
        - matches(), starts_with(), countains(), num_range(), everything()  

    - **mutate()**, mutate_at(), mutate_if(), transmute(), add_column(), rename()
        - sum(), mean(), sd(), quantile(), n(), n_distinct(), if_else(), recode()

- Funções de síntese

    - **summarise()**, summarise_all(), summarise_at(), summarise_if()
    - **group_by()**, ungroup(), group_by_all(), group_by_at(), group_by_if() 
---

class: middle

#### Para relembrar e fazer os desafios de dplyr da oficina de R básico:


- https://bit.ly/rladiesSP5

---
class:  center, middle
# Introdução ao Join
---
**Carregar o dataset**

Utilizaremos o dataset `diamonds`, que vem no pacote ggplot2. 

```r
library(tidyverse)
#install.packages("ggplot2")
library(ggplot2)
diamonds &lt;- ggplot2::diamonds
DT::datatable(head(diamonds), fillContainer = TRUE)
```

<div id="htmlwidget-bf5fc5b67b7f55b78a53" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-bf5fc5b67b7f55b78a53">{"x":{"filter":"none","fillContainer":true,"data":[["1","2","3","4","5","6"],[0.23,0.21,0.23,0.29,0.31,0.24],["Ideal","Premium","Good","Premium","Good","Very Good"],["E","E","E","I","J","J"],["SI2","SI1","VS1","VS2","SI2","VVS2"],[61.5,59.8,56.9,62.4,63.3,62.8],[55,61,65,58,58,57],[326,326,327,334,335,336],[3.95,3.89,4.05,4.2,4.34,3.94],[3.98,3.84,4.07,4.23,4.35,3.96],[2.43,2.31,2.31,2.63,2.75,2.48]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>carat<\/th>\n      <th>cut<\/th>\n      <th>color<\/th>\n      <th>clarity<\/th>\n      <th>depth<\/th>\n      <th>table<\/th>\n      <th>price<\/th>\n      <th>x<\/th>\n      <th>y<\/th>\n      <th>z<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,5,6,7,8,9,10]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

---
# dplyr - combinando tabelas


```r
band_members
## # A tibble: 3 x 2
##   name  band   
##   &lt;chr&gt; &lt;chr&gt;  
## 1 Mick  Stones 
## 2 John  Beatles
## 3 Paul  Beatles
band_surnames &lt;- tibble(surname = c("Jagger", "Lennon", "McCatney"))
bind_cols(band_members, band_surnames)
## # A tibble: 3 x 3
##   name  band    surname 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   
## 1 Mick  Stones  Jagger  
## 2 John  Beatles Lennon  
## 3 Paul  Beatles McCatney
```

---
# dplyr - combinando tabelas

&lt;br&gt;

&lt;img src="img/dplyr_bind_1.png" width="83%" style="display: block; margin: auto;" /&gt;


&lt;br&gt;


&lt;img src="img/dplyr_bind_2.png" width="77%" style="display: block; margin: auto;" /&gt;

---
# dplyr - mesclando tabelas

&lt;br&gt; 

&lt;img src="img/dplyr_join_2.png" width="85%" style="display: block; margin: auto;" /&gt;

---
# dplyr - mesclando tabelas



```r
band_members %&gt;% glimpse()
## Observations: 3
## Variables: 2
## $ name &lt;chr&gt; "Mick", "John", "Paul"
## $ band &lt;chr&gt; "Stones", "Beatles", "Beatles"
band_instruments %&gt;%  glimpse()
## Observations: 3
## Variables: 2
## $ name  &lt;chr&gt; "John", "Paul", "Keith"
## $ plays &lt;chr&gt; "guitar", "bass", "guitar"
left_join(band_members, band_instruments, by = "name") %&gt;% glimpse()
## Observations: 3
## Variables: 3
## $ name  &lt;chr&gt; "Mick", "John", "Paul"
## $ band  &lt;chr&gt; "Stones", "Beatles", "Beatles"
## $ plays &lt;chr&gt; NA, "guitar", "bass"
```


---
# dplyr - mesclando tabelas



```r
right_join(band_members, band_instruments, by = "name") %&gt;% glimpse()
## Observations: 3
## Variables: 3
## $ name  &lt;chr&gt; "John", "Paul", "Keith"
## $ band  &lt;chr&gt; "Beatles", "Beatles", NA
## $ plays &lt;chr&gt; "guitar", "bass", "guitar"
inner_join(band_members, band_instruments) %&gt;% glimpse()
## Joining, by = "name"
## Observations: 2
## Variables: 3
## $ name  &lt;chr&gt; "John", "Paul"
## $ band  &lt;chr&gt; "Beatles", "Beatles"
## $ plays &lt;chr&gt; "guitar", "bass"
full_join(band_members, band_instruments, by = "name") %&gt;% glimpse()
## Observations: 4
## Variables: 3
## $ name  &lt;chr&gt; "Mick", "John", "Paul", "Keith"
## $ band  &lt;chr&gt; "Stones", "Beatles", "Beatles", NA
## $ plays &lt;chr&gt; NA, "guitar", "bass", "guitar"
```


---
# dplyr - mesclando tabelas



```r
glimpse(band_members)
## Observations: 3
## Variables: 2
## $ name &lt;chr&gt; "Mick", "John", "Paul"
## $ band &lt;chr&gt; "Stones", "Beatles", "Beatles"
glimpse(band_instruments2)
## Observations: 3
## Variables: 2
## $ artist &lt;chr&gt; "John", "Paul", "Keith"
## $ plays  &lt;chr&gt; "guitar", "bass", "guitar"
left_join(band_members, band_instruments2, by=c("name"="artist")) %&gt;% glimpse()
## Observations: 3
## Variables: 3
## $ name  &lt;chr&gt; "Mick", "John", "Paul"
## $ band  &lt;chr&gt; "Stones", "Beatles", "Beatles"
## $ plays &lt;chr&gt; NA, "guitar", "bass"
```

---
# dplyr - mesclando tabelas


```r
base_A &lt;- tibble(chave_nome_igual = c(1:3,NA), chave_nome_diferente_A = c(1:3,NA) , 
            var_nome_igual = letters[1:4], var_nome_diferente_A = letters[1:4]) %&gt;% 
  glimpse()
## Observations: 4
## Variables: 4
## $ chave_nome_igual       &lt;int&gt; 1, 2, 3, NA
## $ chave_nome_diferente_A &lt;int&gt; 1, 2, 3, NA
## $ var_nome_igual         &lt;chr&gt; "a", "b", "c", "d"
## $ var_nome_diferente_A   &lt;chr&gt; "a", "b", "c", "d"
```


```r
base_B &lt;- tibble(chave_nome_igual = c(2:4,NA), chave_nome_diferente_B = c(2:4,NA), 
            var_nome_igual = letters[5:8], var_nome_diferente_B = letters[5:8]) %&gt;% 
  glimpse()
## Observations: 4
## Variables: 4
## $ chave_nome_igual       &lt;int&gt; 2, 3, 4, NA
## $ chave_nome_diferente_B &lt;int&gt; 2, 3, 4, NA
## $ var_nome_igual         &lt;chr&gt; "e", "f", "g", "h"
## $ var_nome_diferente_B   &lt;chr&gt; "e", "f", "g", "h"
```

---
# dplyr - mesclando tabelas


```r
full_join(base_A, base_B, 
          by = c("chave_nome_igual" = "chave_nome_igual", 
                 "chave_nome_diferente_A" = "chave_nome_diferente_B"),
          suffix =c(".A",".B")) %&gt;% 
  glimpse()
## Observations: 5
## Variables: 6
## $ chave_nome_igual       &lt;int&gt; 1, 2, 3, NA, 4
## $ chave_nome_diferente_A &lt;int&gt; 1, 2, 3, NA, 4
## $ var_nome_igual.A       &lt;chr&gt; "a", "b", "c", "d", NA
## $ var_nome_diferente_A   &lt;chr&gt; "a", "b", "c", "d", NA
## $ var_nome_igual.B       &lt;chr&gt; NA, "e", "f", "h", "g"
## $ var_nome_diferente_B   &lt;chr&gt; NA, "e", "f", "h", "g"
```

---
class:  center, middle
# Introdução ao purrr

---
# purrr - programação funcional

&gt; em construção
R tem o core de uma linguagem funcional, 
com uma natureza de soluções centrada em funções 


- faça para 1
- crie a receita
- faça para todos!


---
# purrr - map

&gt; em construção
**map(.x,.f)** 

Para cada ** .x ** faça ** .f **, onde:
- .x: vetor, uma lista, colunas de um data frame
- .f: o céu é o limite :)
---
# purrr - map &amp; variações
&gt; em construção
O **map()** sempre retorna uma lista, outras possibilidades:

- **map_lgl()** - lógico
- **map_chr()** - caracter
- **map_int()** - inteiro
- **map_dbl()** - double
- **map_dfr()** - 
- **map_dfc()** - 




---
class:  center, middle
# Introdução ao ggplot2 
---
### O que é o ggplot2?

- É um pacote usado para visualização de dados.

- É uma implementação dos conceitos e definições sobre o que é um gráfico oriundos do livro _Grammar of Graphics_ de Leland Wilkinson. 

- [Cheatsheet em português](https://www.rstudio.com/wp-content/uploads/2016/03/ggplot2-cheatsheet-portuguese.pdf)

- **Materiais interessantes:**

  *[Workshop Code Your Graph](https://alison.rbind.io/html/jamboree_heart_ggplot.html)

  *[R for Data Science - capítulos 3 e 28](https://r4ds.had.co.nz/data-visualisation.html)

&lt;img src="img/ggplot2.png" width="30%" style="display: block; margin: auto;" /&gt;
---
# O que é o grammar of graphics?
  
  - A ideia básica é que de forma independente podemos 
especificar  e combinar blocos de construção de um gráfico para criar praticamente qualquer tipo de exibição gráfica desejada. 

- Os blocos de construção (ou camadas)  de um gráfico incluem:

  - data
  - aesthetic mapping
  - geometric object
  - statistical transformations
  - scales
  - coordinate system
  - position adjustments
  - faceting
  
---
** Exemplo passo a passo - geom_histogram() **
  A função ggplot() recebe um data frame e cria a camada base do gráfico. Se rodarmos somente ela, teremos um painel em branco:


```r
diamonds %&gt;% ggplot() #usando o pipe
```

&lt;img src="index_files/figure-html/unnamed-chunk-34-1.png" style="display: block; margin: auto;" /&gt;
---
** Exemplo passo a passo - geom_histogram() **
  Porém, para construirmos o gráfico precisamos dizer como as observações das nossas variáveis serão representadas no gráfico e e para isso usamos a camada de mapeamento estético.
  A combinação ggplot() + geom_() é o que definirá o tipo de gráfico que queremos gerar


```r
diamonds %&gt;% ggplot() +
  geom_histogram(mapping = aes(x = depth))
```

```
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
```

&lt;img src="index_files/figure-html/unnamed-chunk-35-1.png" style="display: block; margin: auto;" /&gt;
---
** Desafio 1 **
  Plotar a distribuição de frequências (também conhecida como histograma) da variável price

---
** Desafio 1 - RESPOSTA **
  Plotar a distribuição de frequências (também conhecida como histograma) da variável price


```r
#lembre-se que as camadas sÃ£o unidas por um + e nÃ£o por  %&gt;% 
diamonds %&gt;% ggplot() +
  geom_histogram(mapping = aes(x = price))
```

```
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
```

&lt;img src="index_files/figure-html/unnamed-chunk-36-1.png" style="display: block; margin: auto;" /&gt;
---
** Exemplo passo a passo 2: geom_bar **
  Para variáveis categóricas, ou seja, aquelas que representam uma categoria como qualidade (bom, ruim), sexo(M, F) ou no nosso caso, a qualidade do corte da pedra, podemos usar um gráfico de barras


```r
diamonds %&gt;% ggplot() +
  geom_bar(aes(x=cut))
```

&lt;img src="index_files/figure-html/unnamed-chunk-37-1.png" style="display: block; margin: auto;" /&gt;
---
** Exemplo passo a passo 2: geom_bar **
  Podemos preencher as colunas com a informação sobre a cor das pedras


```r
diamonds %&gt;% ggplot()+
  geom_bar(aes(x=cut, fill=color))
```

&lt;img src="index_files/figure-html/unnamed-chunk-38-1.png" style="display: block; margin: auto;" /&gt;
---
** Exemplo passo a passo 2: geom_bar **
  Com a camada theme_bw() podemos mudar o fundo do nosso gráfico


```r
diamonds %&gt;% ggplot() + 
  geom_bar(aes(x=cut, fill=color)) + theme_bw()
```

&lt;img src="index_files/figure-html/unnamed-chunk-39-1.png" style="display: block; margin: auto;" /&gt;
---
** Exemplo passo a passo 2: geom_bar **
  Usando a função labs() podemos inserir títulos e legendas apropriadas para nosso gráfico


```r
diamonds %&gt;%  ggplot(aes(x=cut, fill=color)) +
  geom_bar() + theme_bw() +
  labs(title = "Título do gráfico", x = "Corte do diamante", 
    y = "Contagem", fill = "Cor")
```

&lt;img src="index_files/figure-html/unnamed-chunk-40-1.png" style="display: block; margin: auto;" /&gt;
---
** Desafio 2 **
  Plote um gráfico de barras da váriavel claridade da pedra incluindo a informação sobre a cor da pedra para cada tipo de claridade de pedra. Use também legendas apropriadas 

---
** Desafio 2 - RESPOSTA **
  Plote um gráfico de barras da váriavel claridade da pedra incluindo a informação sobre a cor da pedra para cada tipo de claridade de pedra. Use também legendas apropriadas 


```r
diamonds %&gt;%  ggplot(aes(x=clarity, fill=color)) +
  geom_bar() + theme_bw() +
  labs(title = "Cores dos diamantes por tipo de claridade", x = "Claridade do diamante", 
    y = "Contagem", fill = "Cor")
```

&lt;img src="index_files/figure-html/unnamed-chunk-41-1.png" style="display: block; margin: auto;" /&gt;
---
** Exemplo passo a passo 3: geom_point **


```r
diamonds %&gt;% ggplot() + geom_point(aes(x = carat, y = price))
```

&lt;img src="index_files/figure-html/unnamed-chunk-42-1.png" style="display: block; margin: auto;" /&gt;
---
** Exemplo passo a passo 3: geom_point **
  Podemos estabelecer um tamanho médio por pedra e classificá-las como pequenas ou grandes
  

```r
diamonds %&gt;%
   mutate(
    tamanho = (x + y + z)/3,
    tamanho = ifelse(tamanho &lt;= 6, "Pequena", "Grande")
  ) %&gt;% 
  filter(!is.na(tamanho)) %&gt;% 
  ggplot() + 
  geom_point(mapping = aes(x = carat, y = price, color = tamanho))
```

&lt;img src="index_files/figure-html/unnamed-chunk-43-1.png" style="display: block; margin: auto;" /&gt;
---
** Exemplo passo a passo 3: geom_point **

Dois pontos importantes nesse exemplo:

- Aqui fomos capazes de juntar os conceitos aprendidos até aqui do dplyr usando as funções mutate() e filter() juntamente com os as funções do ggplot2. Isso é extremamente comum quando estamos lidando com a visualização de dados.

- O atributo color foi utilizado dentro da função aes(), pois temos a variável tamanho que precisa ser mapeada para ser representada no gráfico.

---
** Exemplo passo a passo 3: geom_point ** 
  Outro exemplo


```r
diamonds %&gt;%
   mutate(
    compra = ifelse(cut == "Fair" &amp; price &gt;= 5000, "Não vale a pena comprar", "Top")) %&gt;% 
  ggplot() + 
  geom_point(mapping = aes(x = carat, y = price, color = compra))
```

&lt;img src="index_files/figure-html/unnamed-chunk-44-1.png" style="display: block; margin: auto;" /&gt;
---
** Desafio 3 **

Plote um gráfico de dispersão das variáveis price e carat pintando os pontos de acordo com a qualidade do corte das pedras

---
** Desafio 3 **
  Plote um gráfico de dispersão das variáveis price e carat pintando os pontos de acordo com a qualidade do corte das pedras
  

```r
diamonds %&gt;% ggplot() + 
  geom_point(mapping = aes(x = carat, y = price, color = cut))
```

&lt;img src="index_files/figure-html/unnamed-chunk-45-1.png" style="display: block; margin: auto;" /&gt;
---
# Atributos estéticos

* A função aes() indica a relação entre os dados e cada aspecto visual do gráfico, ou seja, qual variável será representada no eixo x, no eixo y, o tipo de linha do gráfico, a cor e o tamanho dos componentes geométricos, etc.
 
  * Os aspectos visuais mais utilizados incluem:
 
**color=**: altera a cor de formas que não têm área (pontos e retas).

**fill=**: altera a cor de formas com área (barras, caixas, densidades, áreas).

**size=**: altera o tamanho de formas.

**type=**: altera o tipo da forma, geralmente usada para pontos.

**linetype=**: altera o tipo da linha.
---
# Formas geométricas
  * Os _geoms_ basicamente definem o tipo de gráfico que queremos construir.
  Os principais são:

*geom_line* - para linhas definidas por pares (x,y).

*geom_abline* - para retas definidas por um intercepto e uma inclinação.

*geom_hline* - para retas horizontais.

*geom_bar* - para barras.

*geom_histogram* - para histogramas.

*geom_boxplot* - para boxplots.

*geom_density* - para densidades.

*geom_area* - para áreas.
---
# Quais aspectos visuais utilizar para cada geom_ ?
  * Depende do que se quer mostrar no gráfico e do que cada geom_ aceita como aspecto visual
  * Porém, temos um gif muito bom para isso:
  



```r
frameWidget(edgebundle(graph_from_data_frame(relationship), tension = 0.45, cutoff = 0.1, width = NULL, fontsize = 14,
  padding = 110, nodesize = c(5, 20), directed = FALSE), height = "600")
```

<div id="htmlwidget-9599f1176cdfee9d5eba" style="width:100%;height:600px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-9599f1176cdfee9d5eba">{"x":{"url":"index_files/figure-html//widgets/widget_unnamed-chunk-47.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
[Fonte](https://www.yihanwu.ca/post/geoms-and-aesthetic-parameters/)
---
# Associando gráficos
  Imagine que temos dois gráficos que mapeiam as mesmas variáveis:


```r
# esquerda
diamonds %&gt;% 
  ggplot() + 
  geom_point(aes(x = carat, y = price))
```

&lt;img src="index_files/figure-html/unnamed-chunk-48-1.png" style="display: block; margin: auto;" /&gt;

```r
# direita
diamonds %&gt;% 
  ggplot() + 
  geom_smooth(aes(x = carat, y = price))
```

```
## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'
```

&lt;img src="index_files/figure-html/unnamed-chunk-49-1.png" style="display: block; margin: auto;" /&gt;

---
# Associando gráficos
  Podemos simplesmente escrever:

```r
# juntos
diamonds %&gt;% 
  ggplot() + 
  geom_point(aes(x = carat, y = price)) +
  geom_smooth(aes(x = carat, y = price))
```

```
## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'
```

&lt;img src="index_files/figure-html/unnamed-chunk-50-1.png" style="display: block; margin: auto;" /&gt;

---
# Associando gráficos
  Podemos ainda especificar a função aes() dentro da função ggplot2 para não repetirmos ela duas vezes (e assim evitar possíveis erros, pois diferentes váriáveis podem ser mapeadas no gráfico)


```r
diamonds %&gt;% 
  ggplot(aes(x = carat, y = price)) + 
  geom_point(aes(color = color)) +
  geom_smooth()
```

```
## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'
```

&lt;img src="index_files/figure-html/unnamed-chunk-51-1.png" style="display: block; margin: auto;" /&gt;
---
# Associando gráficos
  Podemos também reproduzir um mesmo gráfico para várias categorias de uma dada variável:


```r
diamonds %&gt;% 
  ggplot(aes(x = carat, y = price)) + 
  geom_point(aes(color = color)) +
  geom_smooth() +
  facet_wrap(~cut) #testar parametros ncol e nrow
```

```
## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'
```

&lt;img src="index_files/figure-html/unnamed-chunk-52-1.png" style="display: block; margin: auto;" /&gt;

---
** Desafio 4 **

  Plote um gráfico de dispersão das variáveis price e carat pintando os pontos de acordo com a qualidade do corte das pedras juntamente com a linha de tendência desses pontos (e seu intervalo de confiança) para cada uma das categorias da variável color
---
** Desafio 4 - RESPOSTA **
  Plote um gráfico de dispersão das variáveis price e carat pintando os pontos de acordo com a qualidade do corte das pedras juntamente com a linha de tendência desses pontos (e seu intervalo de confiança) para cada uma das categorias da variável color


```r
diamonds %&gt;% 
  ggplot(mapping = aes(x = carat, y = price)) + 
  geom_point(aes(color = cut)) +
  geom_smooth() +
  facet_wrap(~color)
```

```
## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'
```

&lt;img src="index_files/figure-html/unnamed-chunk-53-1.png" style="display: block; margin: auto;" /&gt;
---
class:  inverse, center, middle
## Temos mais um tempinho?
---
# Associando diferentes gráficos
  Dessa vez precisamos de um pacote extra chamado patchwork

```r
#instale o pacote com esse comando:
devtools::install_github("thomasp85/patchwork")
```

```
## Skipping install of 'patchwork' from a github remote, the SHA1 (fd7958ba) has not changed since last install.
##   Use `force = TRUE` to force installation
```

```r
#carregue o pacote
library(patchwork)
```
---
** Desafio 5 - E ÚLTIMO! **

Plote quaisquer dois gráficos usando o ggplot2 e salve cada um deles em um objeto chamado grafico1 e grafico2, respectivamente (pode ser os gráficos mais simples que vimos no começo, como o histograma e o gráfico de dispersão)

---
** Desafio 5 - RESPOSTA **

```r
grafico1 &lt;- diamonds %&gt;%  
  ggplot(aes(x=clarity, fill=color)) +
  geom_bar() + theme_bw() +
  labs(title = "Cores dos diamantes por tipo de claridade", x = "Claridade do diamante", 
    y = "Contagem", fill = "Cor")

grafico2 &lt;- diamonds %&gt;% 
  filter(color %in% c("E", "F", "G", "H", "I", "J")) %&gt;%
  ggplot() + 
  geom_boxplot(aes(x = color, y = price, fill = color), show.legend = FALSE) +
  labs(title = "Boxplot das cores dos diamantes", x = "Cor do diamante", 
    y = "Preço do diamante")

grafico1 + grafico2
```

&lt;img src="index_files/figure-html/unnamed-chunk-55-1.png" style="display: block; margin: auto;" /&gt;












---
class:  center, middle
# Introdução ao Rmarkdown

---
## Rmarkdown
* Possibilita exportar diferentes tipos de arquivos.
&lt;img src="img/markdown.png" width="50%" style="display: block; margin: auto;" /&gt;

---
class: middle
## Como criar um arquivo RMarkdown?

No RStudio, clique em File → New File → R Markdown 
&lt;img src="img/1.PNG" width="267" style="display: block; margin: auto;" /&gt;
 
---
class: middle
## Como criar um arquivo RMarkdown?

&lt;img src="img/New_R_Markdown.png" width="90%" style="display: block; margin: auto;" /&gt;

---
class:  middle

## yaml - metadados do documento:
- **y**et **a**nother **m**arkup **l**anguage 
- Controla muitas das configurações do documento.
- title: título
- subtitle: subtítulo
- author: autor
- date: data
- output: formato (Ex: html_document, pdf_document, etc). 
- Cuidado com a **identação**

Leia também: [Output Formats - R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/output-formats.html)




```r
---
title: "Initial R Markdown document"
author: "Karl Broman"
date: "April 23, 2015"
output: html_document
---
```
---
## Markdown
* O markdown é uma linguagem de marcação simples. 
* [Rmarkdown Cheatsheet](http://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf)
* Elaborada para ser fácil de ler, fácil de escrever.


**Negrito**: `**bold**` 

_Itálico_: `_italics_`

---
##Sintaxe Markdown
**Adicionar títulos**

`# Título 1`

`## Título 2`

`### Título 3` 

# Título 1
## Título 2
### Título 3

---
class: middle
## Fazendo uma lista
Você pode fazer uma lista escrevendo com hífens ou asteriscos, como a seguir:

`* negrito com asteriscos duplos`

`* itálico com underline`

`* fonte do tipo código com crase`

ou dessa forma:

`- negrito com asteriscos duplos`

`- itálico com underline`

`- fonte do tipo código com crase`

Cada um vai aparecer como:

- negrito com asteriscos duplos
- itálico com underline
- fonte do tipo código com crase

Referência: [SW Carpentry](https://swcarpentry.github.io/r-novice-gapminder/15-knitr-markdown/index.html)


---
class: middle
## Fazendo uma lista enumerada
Você pode fazer uma lista numerada usando somente números. Você pode usar o mesmo número quantas vezes quiser: 

`1. negrito com asteriscos duplos`

`1. itálico com underline`

`1. fonte do tipo código com crase`

Isso irá aparecer como:

1. negrito com asteriscos duplos
1. itálico com underline
1. fonte do tipo código com crase


Referência: [SW Carpentry](https://swcarpentry.github.io/r-novice-gapminder/15-knitr-markdown/index.html)




---
class: middle
## Compilando o RMarkdown

Você compila o documento de RMarkdown para uma página html ao clicar no botão "Knit HTML" no canto superior esquerdo. 

&lt;img src="img/knit.png" width="50%" style="display: block; margin: auto;" /&gt;

---
### Desafio
Crie um novo documento R Markdown. Delete todos os chuncks de código de R e escreva um pouco de Markdown (algumas seções, textos estilizados e lista com itens). 

Converta o documento em uma webpage.

Você pode usar o [Rmarkdown Cheatsheet](http://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf) para referência.

Referência: [SW Carpentry](https://swcarpentry.github.io/r-novice-gapminder/15-knitr-markdown/index.html)

---
class: middle
#$ Mais de Markdown

Você pode fazer um hiperlink dessa forma: `[**texto para mostrar**](http://the-web-page.com)`.

Você pode incluir arquivo de imagem dessa forma: `![**título**](http://url/for/file)`

Você pode fazer sobescrito (e.g., F~2~) com `F~2` e superescrito (e.g., F^2^) com `F^2^`.

Se você sabe como escrever equações em LaTeX, ficará feliz em saber que pode usar $ $ e $$ $$ para inserir equações matemáticas, como e `$E = mc^2$`e

`$$y = \mu + \sum_{i=1}^p \beta_i x_i + \epsilon$$`

Referência: [SW Carpentry](https://swcarpentry.github.io/r-novice-gapminder/15-knitr-markdown/index.html)

---
class: middle
#$ Chuncks de Código R

Markdown é interessante e útil, mas seu real poder vem da combinação de Markdown com chuncks de códigos em R. 
Isso  é o Markdown. Quando processado, o código em R será executado; se ele produz figuras, as figuras serão inseridas ao final do documento.

&lt;img src="img/chunk.png" width="788" style="display: block; margin: auto;" /&gt;



- É uma boa ideia dar a cada chunck um nome, pois ele podem ajudar a corrigir erros, e, se quaisquer gráficos são produzidos, os nomes dos arquivos serão baseados no nome do chunck de código que os produzirem.


Referência: [SW Carpentry](https://swcarpentry.github.io/r-novice-gapminder/15-knitr-markdown/index.html)
---
class: middle
## Como criar um chunck de código?

&lt;img src="img/8.PNG" width="267" style="display: block; margin: auto;" /&gt;
 
Dica: Atalho do teclado para criar chunks:  `Ctrl + ALt + I`.


# Desafio
Adicione chunks de código para carregar o pacote dplyr

 
---
class: middle
## Como as coisas são compiladas?

- Quando você pressiona o botão “Knit HTML”, o documento R Markdown é processado pelo knitr e um documento Markdown é produzido (como, também, um potencial conjunto de arquivos de figuras): o código em R é executado e substituído pelo input e output; se figuras são produzidas, links para essas figuras serão incluídos.

- A seguir, os documentos Markdown e de figuras  são processados pela ferramenta pandoc, que converte o arquivo Markdown em um arquivo html, com as figuras anexadas.


&lt;img src="img/rmd-15-rmd_to_html_fig-1.png" width="768" style="display: block; margin: auto;" /&gt;

Referência: [SW Carpentry](https://swcarpentry.github.io/r-novice-gapminder/15-knitr-markdown/index.html)


---
class: middle
## Opções de chunck

Há uma variedade de opções que podem afetar como os chuncks de código são tratados.

- Use `echo=FALSE` para evitar que o próprio código apareça.

- Use `results="hide"` para evitar que qualquer resultado seja impresso.

- Use `eval=FALSE` para mostrar o código, mas ele não é avaliado.

- Use `warning=FALSE` e `message=FALSE` para ocultar qualquer messagens de avisos produzidas.

- Use `out.width` para controlar o tamanho de figuras produzidas (Ex: `out.width = "100%"`).



Assim, você pode escrever:

&lt;img src="img/chunk_load_libraries.png" width="791" style="display: block; margin: auto;" /&gt;
 
Referência: [SW Carpentry](https://swcarpentry.github.io/r-novice-gapminder/15-knitr-markdown/index.html)
 
---
class: middle
## Opções globais de chunck
Muitas vezes, haverá algumas opções que você irá querer repetir seu uso; para isso, você pode configurar as opções globais de chinck, como:  


&lt;img src="img/chunk_global_options.png" width="788" style="display: block; margin: auto;" /&gt;

A opção `fig.path` define onde as figuras serão salvas. A `/` é importante, pois sem ela, as figuras seriam salvas no local padroã, mas só com nomes que começam com Figs. 



Referência: [SW Carpentry](https://swcarpentry.github.io/r-novice-gapminder/15-knitr-markdown/index.html)

---
class: middle
## Inline R code
Você pode fazer com que todo número em seu relatório seja reproduzível. 


```r
#Use `r e ` para um in-line code chunk . 
#O código será executado e
#substituído com o valor do resultado.
```




```r
`r code`

Ex:

`r round(3.14159265359, 2)`
```

3.14

Não deixe que esse chunck in-line seja separado através das linhas.

 

Referência: [SW Carpentry](https://swcarpentry.github.io/r-novice-gapminder/15-knitr-markdown/index.html)
---
class: middle
## Inline R code
Outro examplo:

```r
# O dataframe mtcars possui `r nrow(mtcars)` carros. 
```

Exemplo: O dataframe mtcars possui 32 carros.
---
class: middle
## Desafio


- Tente um pouco de código R in-line.


Referência: [SW Carpentry](https://swcarpentry.github.io/r-novice-gapminder/15-knitr-markdown/index.html)


---
class: middle
## Exemplo: adicionando um gráfico

```r
attach(mtcars)
```

```
## The following object is masked from package:ggplot2:
## 
##     mpg
```

```r
plot(wt, mpg, main="Exemplo de Gráfico de Dispersão",
xlab="Peso do Carro ", ylab="Milhas Por Galão ", pch=19)
```

&lt;img src="index_files/figure-html/unnamed-chunk-69-1.png" style="display: block; margin: auto;" /&gt;
---
class: middle
## Exemplo: adicionando uma tabela simples


```r
head(mtcars)
```

```
##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
```
---
class: middle
## Exemplo: adicionando uma tabela

```r
DT::datatable(head(mtcars, 10),
  fillContainer = FALSE, options = list(pageLength = 5))
```

<div id="htmlwidget-a22dbbd22d8734c04ad9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a22dbbd22d8734c04ad9">{"x":{"filter":"none","fillContainer":false,"data":[["Mazda RX4","Mazda RX4 Wag","Datsun 710","Hornet 4 Drive","Hornet Sportabout","Valiant","Duster 360","Merc 240D","Merc 230","Merc 280"],[21,21,22.8,21.4,18.7,18.1,14.3,24.4,22.8,19.2],[6,6,4,6,8,6,8,4,4,6],[160,160,108,258,360,225,360,146.7,140.8,167.6],[110,110,93,110,175,105,245,62,95,123],[3.9,3.9,3.85,3.08,3.15,2.76,3.21,3.69,3.92,3.92],[2.62,2.875,2.32,3.215,3.44,3.46,3.57,3.19,3.15,3.44],[16.46,17.02,18.61,19.44,17.02,20.22,15.84,20,22.9,18.3],[0,0,1,1,0,1,0,1,1,1],[1,1,1,0,0,0,0,0,0,0],[4,4,4,3,3,3,3,4,4,4],[4,4,1,1,2,1,4,2,2,4]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mpg<\/th>\n      <th>cyl<\/th>\n      <th>disp<\/th>\n      <th>hp<\/th>\n      <th>drat<\/th>\n      <th>wt<\/th>\n      <th>qsec<\/th>\n      <th>vs<\/th>\n      <th>am<\/th>\n      <th>gear<\/th>\n      <th>carb<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
---
class: middle
## Adicionando imagens usando o Knitr

Função: `knitr::include_graphics()`

Exemplo:

```r
knitr::include_graphics("https://www.r-project.org/Rlogo.png")
```

&lt;img src="https://www.r-project.org/Rlogo.png" width="50%" style="display: block; margin: auto;" /&gt;
---
class: middle
## Adicionando imagens usando Knitr: opções de Chunk 

- `out.width = "50%"` - tamanho da imagem


&lt;img src="https://www.r-project.org/Rlogo.png" width="50%" style="display: block; margin: auto;" /&gt;

[Opções do KnitR](https://yihui.name/knitr/options/#chunk-options)

---
class: middle
##Adicionando imagens usando Knitr: opções de Chunk 

- **Alinhamento da figura**
- `fig.align = 'center', 'default', **'left'**,'right'` 

&lt;img src="https://www.r-project.org/Rlogo.png" width="20%" style="display: block; margin: auto auto auto 0;" /&gt;

- `fig.align = 'center', 'default', 'left', **'right' **`

&lt;img src="https://www.r-project.org/Rlogo.png" width="20%" style="display: block; margin: auto 0 auto auto;" /&gt;
---
class: middle
##Adicionando imagens usando Knitr: opções de Chunk 

- Legenda de figura 

- `fig.cap="Logo R"`


&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="https://www.r-project.org/Rlogo.png" alt="R Logo" width="50%" /&gt;
&lt;p class="caption"&gt;R Logo&lt;/p&gt;
&lt;/div&gt;
---

class: middle
## Desafio
- Adicionar imagem 

- Usar opções de chunk para controlar o tamanho da figura e para esconder o código. 



Refêrencia: [SW Carpentry](https://swcarpentry.github.io/r-novice-gapminder/15-knitr-markdown/index.html)
---
class: middle
## Outras opções de saída
Você também pode converter o R Markdown para PDF ou um documento Word. Clique no pequeno triângulo próximo ao botão "Knit HTML" para aparecer um menu. Ou você pode colocar pdf_document ou word_document ino cabeçalho do arquivo.

&lt;img src="img/knit.png" width="276" style="display: block; margin: auto;" /&gt;

Dica: Criando documentos em PDF
Criando documentos em .pdf pode requerer a instalação de TeX. Se pedido, isso é detalhado numa mensagem de erro..



Referência: [SW Carpentry](https://swcarpentry.github.io/r-novice-gapminder/15-knitr-markdown/index.html)

---
##Desafio
- Use o que aprendeu sobre RMarkdown e crie um pequeno relatório das atividades que fizemos hoje!

- O [Cheat Sheet do RMarkdown](http://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf) pode te ajudar!

---
class: middle
## Outras opções de saída

- Você pode fazer apresentações usando R, RMarkdown e KnitR - Use o pacote  [Xaringan](https://github.com/yihui/xaringan); (essa apresentação foi feita com Xaringan!)

- Rmd compila em um formato HTML. Entoã você pode criar páginas html usando essa ferramenta. O pacote **[prettydoc](https://cran.r-project.org/web/packages/prettydoc/vignettes/architect.html)** cpode ajudar com alguns temas se você não sabe prgramar em HTML e CSS.



- Veja a [galeria](https://rmarkdown.rstudio.com/gallery.html) for examples of what you can do with Rmarkdown.

- Veja mais: https://rmarkdown.rstudio.com/index.html

---
## DEU ERRO NO KNITR!

Calma! É bem comum dar erro ao compliar o arquivo pois **qualquer** código errado causa isso. Algumas coisas pra se observar:

- Yaml header - se algo estiver errado, vai dar erro ao compilar. Muito cuidado com a identação!

- Código nos chunks - teste o Run All Chunks e ver se dá erro em algum específico. Se descobrir, tente verificar o que há de errado no código (pode ser a falta de um parênteses, vírgula, entre outros).

&lt;img src="https://media.giphy.com/media/j9GASQ5ocrIRicnmyq/giphy.gif" width="30%" style="display: block; margin: auto;" /&gt;

---
# Referências


- https://r4ds.had.co.nz

- https://www.curso-r.com/material/

- https://www.tidyverse.org

- http://brunaw.com/slides/rladies-sp/13-08-2018/meetup.html#1

- https://github.com/MaryMS/2018-11-R-Course-FatecZS

- https://beatrizmilz.github.io/talk/oficina_intro_r_ufabc_2018/

- [SW Carpentry](https://swcarpentry.github.io/r-novice-gapminder/15-knitr-markdown/index.html)
... 


A apresentação foi feita em [xaringan](https://github.com/yihui/xaringan), um pacote do R! :)


---

class: middle, inverse

# Muito obrigada!

R-Ladies São Paulo
    </textarea>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "<div class=\"progress-bar-container\"> <div class=\"progress-bar\" style=\"width: calc(%current% / %total% * 100%);\"> </div> </div> ",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
